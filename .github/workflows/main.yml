name: onechunk-cross-build


on: [push]

jobs:
  windows_opencl:
    name: opencl/release/windows
    runs-on: [windows-latest]
    steps:
    - uses: actions/checkout@v2
    - uses: msys2/setup-msys2@v2
    - name: build
      run: |
       g++ -w -static -m64 -Ofast -lstdc++ .\filter9000-boinc.cpp -o filter9000.exe -ID:\a\onechunk\onechunk\boinc\ -ID:\a\onechunk\onechunk\boinc\win\ -ID:\a\onechunk\onechunk\Pieces -ID:\a\onechunk\onechunk\Utils -ID:\a\onechunk\onechunk\cubiomes -LD:\a\onechunk\onechunk\boinc\lib\win\ -D_WIN64 -DBOINC -DWIN64 -D_WIN32 -DWIN32
       dir
    - uses: actions/upload-artifact@v2
      with:
       name: onechunk-filter9000-win
       path: .\filter9000.exe

  linux_opencl:
    name: opencl/release/linux
    runs-on: [ubuntu-latest]
    container: nvidia/opencl:devel-ubuntu16.04
    steps:
    - uses: actions/checkout@v2
    - name: build
      run: |
       apt-get update && apt-get install -y \
       rm -rf /var/lib/apt/lists/*
       g++ -w -static -m64 -Ofast -lstdc++ .\filter9000-boinc.cpp -o filter9000 -ID:\a\onechunk\onechunk\boinc\ -ID:\a\onechunk\onechunk\Pieces -ID:\a\onechunk\onechunk\Utils -ID:\a\onechunk\onechunk\cubiomes  -LD:\a\one-chunk\one-chunk\boinc\lib\lin\ -DBOINC
       ls -la
    - uses: actions/upload-artifact@v2
      with:
       name: onechunk-filter9000-lin
       path: ./filter9000
